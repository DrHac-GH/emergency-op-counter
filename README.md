# 緊急手術 参加記録カウンター (MVP)

ブラウザで動く簡易トラッカーです。単体利用（ブラウザ内 `localStorage`）と、同一カウンターを共有できるサーバーモード（同梱のNodeサーバー）に対応します。

## 使い方

1. 単体利用: `index.html` をブラウザで開きます（ローカルでOK）。
2. タブ「記録する」で参加医師（複数選択可）・手術終了時刻（時単位）・メモを入力して「記録する」。
3. 下の「最近の記録」から削除が可能。
4. タブ「集計」で「過去1週間」「過去1ヶ月」の集計とチャートをデフォルト表示。任意の期間も選択可能。
5. 「過去ログ検索」で期間（From/To）を指定して一覧表示・確認できます。検索結果はCSVでエクスポート可能です。
6. タブ「設定」で操作者名の設定、医師の一括追加・個別削除ができます。
7. タブ「管理」でCSVの書き出し/読み込み、全記録の削除、監査ログの閲覧/CSV出力ができます。

## 共有（同一カウンター）で使う: サーバーモード

同梱の `server.js` を使うと、複数端末/複数医師から同じカウンターに記録できます。

- 前提: Node.js 18+ がインストール済み
- 起動: ターミナルでこのフォルダへ移動して実行
  - `node server.js`
- アクセス: 同一ネットワーク内の端末から `http://<サーバーPCのIP>:8080` にアクセス
- 機能: フロントエンドは自動でサーバーモードを検知し、記録/削除/医師管理/CSV入出力をサーバー共有データに対して行います。30秒ごとに自動同期します。
- 監査ログ: 設定タブで操作者名を設定すると、サーバーに操作履歴（追加/削除/初期化等）が記録され、一覧・CSV出力が可能です。

サーバーは `data.json` にデータを保存します（同ディレクトリ）。バックアップはこのファイルを退避してください。
監査ログは設定タブで操作者名を設定してから利用すると、誰が操作したかが記録されます。監査の閲覧/CSV出力は「管理」タブにあります。

## データ項目

- 医師リスト: ユニークな医師名の配列
- 記録: `{ id, datetime(ISO8601), doctors: string[], note }`
  - `datetime` は手術終了時刻（分単位、秒は00固定）。旧データ `{ doctor: string }` も読み込み時に自動変換します。

CSVの列は `datetime,doctor,note`。`doctor` は複数名の場合は `;` 区切り（例: `山田;佐藤`）。`datetime` はローカル時刻（例: `2025-01-31T12:34:00`）。表示は「YYYY/MM/DD HH:MM」です。

## 注意

- 設備をまたぐとデータは共有されません（端末ごと）。バックアップは CSV エクスポートをご利用ください。
- CSV の読み込みは既存データを置き換えます（確認ダイアログあり）。
- 医師を医師リストから削除しても、過去の記録には残ります（選択候補からのみ外れます）。
